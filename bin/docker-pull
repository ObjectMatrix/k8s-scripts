#!/bin/bash

if [ -z "$EXTERNAL_REGISTRY_BASE_DOMAIN" ]; then
  echo "No base domain provided!  Aborting"
  exit 1
else

  case $EXTERNAL_REGISTRY_BASE_DOMAIN in
    *amazonaws.com*)
      bin/registries/docker-pull.ecr.sh ||
        echo "Could not authenticate." && exit 1
      ;;

    *gcr.io*)
      bin/registries/docker-pull.gcr.sh ||
        echo "Could not authenticate." && exit 1
      ;;

    *quay.io*)
      bin/registries/docker-pull.quay.sh ||
        echo "Could not authenticate." && exit 1 
      ;;

  esac
fi
# this should exit 0 even if the image is not there. For example, on a first run
docker pull ${EXTERNAL_REGISTRY_BASE_DOMAIN}/${REPOSITORY_NAME}:latest || true
